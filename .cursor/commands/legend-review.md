# Code Review

Review code changes for a feature before merging.

## Instructions

1. Determine the feature slug from user input
2. Read all feature artifacts:
   - `legend/features/<slug>.spec.md` - requirements
   - `legend/features/<slug>.design.md` - architecture
   - `legend/features/<slug>.implementation.md` - what was built
3. Identify files changed (from implementation.md changes log)
4. Review each file against checklists

## Review Checklists

### Code Quality
- [ ] Follows project naming conventions
- [ ] No unused imports or variables
- [ ] No console.log or debug statements
- [ ] Functions are reasonably sized (< 50 lines)
- [ ] Complex logic has comments
- [ ] No magic numbers (use constants)
- [ ] Error messages are user-friendly

### Security
- [ ] No hardcoded secrets or API keys
- [ ] User input is validated
- [ ] SQL queries use parameterized statements
- [ ] Authentication checks on protected routes
- [ ] Sensitive data not logged
- [ ] CORS configured correctly (if applicable)

### Performance
- [ ] No N+1 query patterns
- [ ] Large lists use pagination
- [ ] Images/assets optimized
- [ ] No unnecessary re-renders (React)
- [ ] Database queries have appropriate indexes
- [ ] No blocking operations in hot paths

### TypeScript
- [ ] No `any` types without justification
- [ ] Interfaces/types defined for data structures
- [ ] Null/undefined handled properly
- [ ] Generic types used appropriately

### Testing
- [ ] Unit tests cover critical paths
- [ ] Edge cases tested
- [ ] Mocks used appropriately
- [ ] Tests are deterministic (no flakiness)

### Accessibility (if UI changes)
- [ ] Semantic HTML used
- [ ] Images have alt text
- [ ] Interactive elements keyboard accessible
- [ ] Color contrast sufficient
- [ ] Form labels associated with inputs

## Output

Generate a review report:

```markdown
# Code Review: <slug>

## Summary
- Files reviewed: X
- Issues found: X (Y critical, Z warnings)
- Recommendation: APPROVE / REQUEST CHANGES / NEEDS DISCUSSION

## Critical Issues
1. **File:** `path/to/file.ts:XX`
   **Issue:** <description>
   **Fix:** <suggested fix>

## Warnings
1. **File:** `path/to/file.ts:XX`
   **Issue:** <description>
   **Suggestion:** <improvement>

## Positive Observations
- <good patterns noticed>

## PR Description (suggested)
<auto-generated PR description based on implementation.md>
```

## Input

Provide: feature slug

Examples:
- `/legend-review user-auth`
- `/legend-review payment-integration`
